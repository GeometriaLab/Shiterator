(function(){function l(a){return a<10?"0"+a:a}function p(a){q.lastIndex=0;return q.test(a)?'"'+a.replace(q,function(a){var b=s[a];return typeof b==="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function m(a,c){var b,d,e,n,h=f,i,g=c[a];g&&typeof g==="object"&&typeof g.toJSON==="function"&&(g=g.toJSON(a));typeof j==="function"&&(g=j.call(c,a,g));switch(typeof g){case "string":return p(g);case "number":return isFinite(g)?String(g):"null";case "boolean":case "null":return String(g);
case "object":if(!g)return"null";f+=o;i=[];if(Object.prototype.toString.apply(g)==="[object Array]"){n=g.length;for(b=0;b<n;b+=1)i[b]=m(b,g)||"null";e=i.length===0?"[]":f?"[\n"+f+i.join(",\n"+f)+"\n"+h+"]":"["+i.join(",")+"]";f=h;return e}if(j&&typeof j==="object"){n=j.length;for(b=0;b<n;b+=1)typeof j[b]==="string"&&(d=j[b],(e=m(d,g))&&i.push(p(d)+(f?": ":":")+e))}else for(d in g)Object.prototype.hasOwnProperty.call(g,d)&&(e=m(d,g))&&i.push(p(d)+(f?": ":":")+e);e=i.length===0?"{}":f?"{\n"+f+i.join(",\n"+
f)+"\n"+h+"}":"{"+i.join(",")+"}";f=h;return e}}function t(a,c,b){if(JSON&&JSON.stringify)return JSON.stringify(a,c,b);var d;o=f="";if(typeof b==="number")for(d=0;d<b;d+=1)o+=" ";else typeof b==="string"&&(o=b);if((j=c)&&typeof c!=="function"&&(typeof c!=="object"||typeof c.length!=="number"))throw Error("JSON.stringify");return m("",{"":a})}function r(){}function u(a){var c=a.length,b=0;c%4&&(a+="0000000".substr(0,4-c%4));var d=0;for(c/=4;d<c;++d)for(var e=0;e<4;++e)b+=a.charCodeAt(d*4+e)<<e*8;return Math.abs(b)%
4294967295}Shiterator=function(a,c){this.__callback=a||r;var b={host:null,port:6666,postingPeriod:1,forgetErrorsAfter:0,errorsLimit:10,ignoreErrors:!0},d;for(d in c)c.hasOwnProperty(d)&&(b[d]=c[d]);this._options=b;this.__ShiteratorInit()};Shiterator.prototype.__ShiteratorInit=function(){this.__started=!1;this.__previousErrorHandler=window.onerror||null;this.__errorsToPost=[];this.__knownErrors=new k(this._options.forgetErrorsAfter||365);this.__errorsCount=0;this.__postErrorTimeout=null;this.__url=
this.__getFullUrl();this.__form=null};Shiterator.prototype.__getFullUrl=function(){if(this._options.host)return(this._options.host.indexOf("http://")!==0?"http://":"")+this._options.host+(this._options.port?":"+this._options.port:"");return null};Shiterator.prototype.__convertErrorToData=function(a,c,b){return{type:"javascript",subject:a+" on "+c+":"+b,message:a,line:b,stack:"not available",tracker:{},file:c,custom:{url:document.location.href,referer:document.referrer}}};Shiterator.prototype.__errorHandler=
function(a,c,b){var d=u(a+" on "+c+":"+b,4),e=this,f=this.__convertErrorToData(a,c,b);if(this.__errorsCount<this._options.errorsLimit&&!this.__knownErrors.has(d)&&(this.__knownErrors.put(d),this.__errorsToPost.push(f),this.__errorsCount++,this.__callback.call(window,f),!this.__postErrorTimeout))this.__postErrorTimeout=setTimeout(function(){e.__submitErrors()},this._options.postingPeriod*1E3);(e.__previousErrorHandler||r)(a,c,b);return this._options.ignoreErrors};Shiterator.prototype.__submitErrors=
function(){if(this.__url){if(!this.__form){var a=document.createElement("div");a.style.display="none";a.innerHTML='<form action="'+this.__url+'" method="post" target="shiterator-error-frame"><input type=\'hidden\' name=\'errors\' value=\'\'></form><iframe id="shiterator-error-frame" name="shiterator-error-frame"></iframe>';document.body.appendChild(a);this.__form=a.getElementsByTagName("form")[0]}var c=a.getElementsByTagName("iframe")[0],a=a.getElementsByTagName("input")[0],b=t(this.__errorsToPost);
a.setAttribute("value",b);c.onload=function(){c.onload=null;self.stop()};this.__form.submit()}};Shiterator.prototype.start=function(){if(!this.__started){var a=this;window.onerror=function(){return a.__errorHandler.apply(a,arguments)};this.__started=!0}};Shiterator.prototype.stop=function(){if(this.__started)window.onerror=this.__previousErrorHandler,this.__errorsCount=this.__errorsToPost.length=0,this.__started=!1};var k=function(a){if(this.constructor._Singleton)return this;else this.constructor._Singleton=
this;this.__retrieveFromCookies(a)};k.prototype.__retrieveFromCookies=function(a){this.__storage=[];var c=this.__getCookie("shiterator");if(c)this.__storage=c.split("/");(c=this.__storage.shift())||(c=new Date((new Date).getTime()+a*864E5));this.__expires=this.__expires=c};k.prototype.__setCookie=function(a,c,b,d,e,f){var h=new Date;h.setTime(h.getTime());h=new Date(b);document.cookie=a+"="+encodeURIComponent(c)+(b?";expires="+h.toGMTString():"")+(d?";path="+d:"")+(e?";domain="+e:"")+(f?";secure":
"")};k.prototype.__getCookie=function(a){for(var c=document.cookie.split(";"),b="",d="",e="",f=0,h=c.length;f<h;++f)if(b=c[f].split("="),d=b[0].replace(/^\s+|\s+$/g,""),d===a)return b.length>1&&(e=decodeURIComponent(b[1].replace(/^\s+|\s+$/g,""))),e;return null};k.prototype.__storeInCookies=function(){this.__setCookie("shiterator",[this.__expires].concat(this.__storage).join("/"),this.__expires)};k.prototype.has=function(a){return this.__storage.indexOf(a)!==-1};k.prototype.put=function(a){this.__storage.push(a);
this.__storeInCookies()};if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+l(this.getUTCMonth()+1)+"-"+l(this.getUTCDate())+"T"+l(this.getUTCHours())+":"+l(this.getUTCMinutes())+":"+l(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var q=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
f,o,s={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},j})();
